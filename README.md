# quartz-spring-boot-starter

## 一、导入Maven配置

## 二、导入[任务配置表](https://github.com/quartz-scheduler/quartz/tree/master/quartz-core/src/main/resources/org/quartz/impl/jdbcjobstore)

Quartz集群的相关表可在Quartz的发布包`org.quartz.impl.jdbcjobstore`目录下找到相关SQL。

🤯 不用过度关注这些表，我们项目中不会主动用到这些表，只要导入到数据库即可。

## 三、必须实现的重要接口

- [IScheduleJob](quartz-core/src/main/java/io/github/lib/quartz/model/IScheduleJob.java)
  任务，调用方要实现改接口，为服务提供任务。注意📢：实现该接口的同时**必须要**实现`Serializable`。
  - String getBeanName()    任务的类名（java.lang.String），或者Bean名称(@Bean("HelloTask") 中的 `HelloTask`)
  - String getMethodName()    待执行的方法
  - String getParams()    待执行方法的参数，最好不用
  - String getJobId()    任务ID
  - ScheduleStatus getStatus()    任务状态 暂停/正常
  - String getCronExpression()    cron表达式
- [JobProvider](quartz-core/src/main/java/io/github/lib/quartz/core/JobProvider.java) 任务提供者。
  - List<IScheduleJob> findAll()   提供全部的任务。
- [JobLogProcessor](quartz-core/src/main/java/io/github/lib/quartz/core/JobLogProcessor.java) 任务执行日志处理者
  - void logProcessor([ScheduleJobLog](quartz-core/src/main/java/io/github/lib/quartz/model/ScheduleJobLog.java)
    scheduleJobLog)    日志处理

⚠️ 实现IScheduleJob的类，一般情况下就是业务中使用的任务。

## 四、任务

```java

@Slf4j
@Component("HelloTask")
public class HelloTask {
  public void each() {
    log.info("测试方法一 ==> {}", new Date());
  }

  public void test() {
    log.info("测试方法二 ==> {}", new Date());
  }
}
```

⚠️ 必须要被Spring管理

## 五、Cron表达式

Cron表达式是一个具有时间含义的字符串，字符串以5个空格隔开，分为6个域，格式为`X X X X X X`。其中`X`是一个域的占位符。单个域有多个取值时，使用半角逗号`,`
隔开取值。每个域可以是确定的取值，也可以是具有逻辑意义的特殊字符。

### 5.1 域取值

下表为Cron表达式中六个域能够取的值以及支持的特殊字符。

| 域   | 是否必需 | 取值范围                                                     | 特殊字符      |
| :--- | :------- | :----------------------------------------------------------- | :------------ |
| 秒   | 是       | [0, 59]                                                      | * , - /       |
| 分钟 | 是       | [0, 59]                                                      | * , - /       |
| 小时 | 是       | [0, 23]                                                      | * , - /       |
| 日期 | 是       | [1, 31]                                                      | * , - / ? L W |
| 月份 | 是       | [1, 12]或[JAN, DEC]                                          | * , - /       |
| 星期 | 是       | [1, 7]或[MON, SUN]。若您使用[1, 7]表达方式，`1`代表星期一，`7`代表星期日。 | * , - / ? L # |

### 5.2 特殊字符

Cron表达式中的每个域都支持一定数量的特殊字符，每个特殊字符有其特殊含义。

| 特殊字符 | 含义                                                         | 示例                                                         |
| :------- | :----------------------------------------------------------- | ------------------------------------------------------------ |
| `*`      | 所有可能的值。                                               | 在月域中，`*`表示每个月；在星期域中，`*`表示星期的每一天。   |
| `,`      | 列出枚举值。                                                 | 在分钟域中，`5,20`表示分别在5分钟和20分钟触发一次。          |
| `-`      | 范围。                                                       | 在分钟域中，`5-20`表示从5分钟到20分钟之间每隔一分钟触发一次。 |
| `/`      | 指定数值的增量。                                             | 在分钟域中，`0/15`表示从第0分钟开始，每15分钟。在分钟域中`3/20`表示从第3分钟开始，每20分钟。 |
| `?`      | 不指定值，仅日期和星期域支持该字符。                         | 当日期或星期域其中之一被指定了值以后，为了避免冲突，需要将另一个域的值设为`?`。 |
| `L`      | 单词Last的首字母，表示最后一天，仅日期和星期域支持该字符。**
说明** 指定`L`字符时，避免指定列表或者范围，否则，会导致逻辑问题。 | 在日期域中，`L`表示某个月的最后一天。在星期域中，`L`表示一个星期的最后一天，也就是星期日（`SUN`）。如果在`L`前有具体的内容，例如，在星期域中的`6L`表示这个月的最后一个星期六。 |
| `W`      | 除周末以外的有效工作日，在离指定日期的最近的有效工作日触发事件。`W`字符寻找最近有效工作日时不会跨过当前月份，连用字符`LW`时表示为指定月份的最后一个工作日。 | 在日期域中`5W`，如果5日是星期六，则将在最近的工作日星期五，即4日触发。如果5日是星期天，则将在最近的工作日星期一，即6日触发；如果5日在星期一到星期五中的一天，则就在5日触发。 |
| `#`      | 确定每个月第几个星期几，仅星期域支持该字符。                 | 在星期域中，`4#2`表示某月的第二个星期四。                    |

### 5.3 取值示例

| 示例                 | 说明                                                         |
| :------------------- | :----------------------------------------------------------- |
| `0/5 * * * * ?`      | 每5秒执行任务一次                                        |
| `0 15 10 ? * *`      | 每天上午10:15执行任务                                        |
| `0 15 10 * * ?`      | 每天上午10:15执行任务                                        |
| `0 0 12 * * ?`       | 每天中午12:00执行任务                                        |
| `0 0 10,14,16 * * ?` | 每天上午10:00点、下午14:00以及下午16:00执行任务              |
| `0 0/30 9-17 * * ?`  | 每天上午09:00到下午17:00时间段内每隔半小时执行任务           |
| `0 * 14 * * ?`       | 每天下午14:00到下午14:59时间段内每隔1分钟执行任务            |
| `0 0-5 14 * * ?`     | 每天下午14:00到下午14:05时间段内每隔1分钟执行任务            |
| `0 0/5 14 * * ?`     | 每天下午14:00到下午14:55时间段内每隔5分钟执行任务            |
| `0 0/5 14,18 * * ?`  | 每天下午14:00到下午14:55、下午18:00到下午18:55时间段内每隔5分钟执行任务 |
| `0 0 12 ? * WED`     | 每个星期三中午12:00执行任务                                  |
| `0 15 10 15 * ?`     | 每月15日上午10:15执行任务                                    |
| `0 15 10 L * ?`      | 每月最后一日上午10:15执行任务                                |
| `0 15 10 ? * 6L`     | 每月最后一个星期六上午10:15执行任务                          |
| `0 15 10 ? * 6#3`    | 每月第三个星期六上午10:15执行任务                            |
| `0 10,44 14 ? 3 WED` | 每年3月的每个星期三下午14:10和14:44执行任务                  |
